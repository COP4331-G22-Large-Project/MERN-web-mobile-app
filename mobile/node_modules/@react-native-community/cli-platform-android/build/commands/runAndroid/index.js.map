{"version":3,"sources":["../../../src/commands/runAndroid/index.ts"],"names":["validatePackageName","packageName","test","displayWarnings","config","args","appId","logger","warn","appFolder","root","runAndroid","_argv","androidProject","project","android","CLIError","jetifier","info","chalk","bold","dim","require","resolve","stdio","error","packager","buildAndRun","port","then","result","startServerInNewWindow","terminal","reactNativePath","message","process","chdir","path","join","cmd","platform","startsWith","appName","androidManifest","fs","readFileSync","packageNameMatchArray","match","length","underline","bgRed","adbPath","deviceId","runOnSpecificDevice","gradlew","devices","adb","getDevices","indexOf","buildApk","sourceDir","installAndLaunchOnDevice","gradleArgs","debug","execa","sync","cwd","tryInstallAppOnDevice","device","variant","toLowerCase","buildDirectory","apkFile","getInstallApkName","pathToApk","adbArgs","availableCPUs","getAvailableCPUs","availableCPU","concat","apkName","existsSync","selectedDevice","isWindows","scriptFile","packagerEnvFilename","portExportContent","launchPackagerScript","scriptsDir","dirname","packagerEnvFile","procConfig","writeFileSync","encoding","flag","detached","name","description","func","options","default","env","RCT_METRO_PORT","parse","val","Number","split"],"mappings":";;;;;;;AAOA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAMA;;;;;;;;;;AAEA;AACA,SAASA,mBAAT,CAA6BC,WAA7B,EAAkD;AAChD,SAAO,wCAAwCC,IAAxC,CAA6CD,WAA7C,CAAP;AACD;;AAED,SAASE,eAAT,CAAyBC,MAAzB,EAAyCC,IAAzC,EAAsD;AACpD,4CAA4BD,MAA5B;;AACA,MAAIC,IAAI,CAACC,KAAT,EAAgB;AACdC,uBAAOC,IAAP,CACE,qGADF;AAGD;;AACD,MAAIH,IAAI,CAACI,SAAT,EAAoB;AAClBF,uBAAOC,IAAP,CACE,yGADF;AAGD;;AACD,MAAIH,IAAI,CAACK,IAAT,EAAe;AACbH,uBAAOC,IAAP,CACE,uEADF;AAGD;AACF;;AAmBD;;;AAGA,eAAeG,UAAf,CAA0BC,KAA1B,EAAgDR,MAAhD,EAAgEC,IAAhE,EAA6E;AAC3EF,EAAAA,eAAe,CAACC,MAAD,EAASC,IAAT,CAAf;AACA,QAAMQ,cAAc,GAAGT,MAAM,CAACU,OAAP,CAAeC,OAAtC;;AAEA,MAAI,CAACF,cAAL,EAAqB;AACnB,UAAM,KAAIG,oBAAJ,EAAc;;;;CAAd,CAAN;AAKD;;AAED,MAAIX,IAAI,CAACY,QAAT,EAAmB;AACjBV,uBAAOW,IAAP,CACG,WAAUC,iBAAMC,IAAN,CACT,UADS,CAET,sCAAqCD,iBAAME,GAAN,CACrC,gDADqC,CAErC,EALJ;;AAQA,QAAI;AACF,YAAM,sBAAMC,OAAO,CAACC,OAAR,CAAgB,qBAAhB,CAAN,EAA8C;AAACC,QAAAA,KAAK,EAAE;AAAR,OAA9C,CAAN;AACD,KAFD,CAEE,OAAOC,KAAP,EAAc;AACd,YAAM,KAAIT,oBAAJ,EAAa,yBAAb,EAAwCS,KAAxC,CAAN;AACD;AACF;;AAED,MAAI,CAACpB,IAAI,CAACqB,QAAV,EAAoB;AAClB,WAAOC,WAAW,CAACtB,IAAD,EAAOQ,cAAP,CAAlB;AACD;;AAED,SAAO,mCAAkBR,IAAI,CAACuB,IAAvB,EAA6BC,IAA7B,CAAmCC,MAAD,IAAoB;AAC3D,QAAIA,MAAM,KAAK,SAAf,EAA0B;AACxBvB,yBAAOW,IAAP,CAAY,4BAAZ;AACD,KAFD,MAEO,IAAIY,MAAM,KAAK,cAAf,EAA+B;AACpCvB,yBAAOC,IAAP,CAAY,oDAAZ;AACD,KAFM,MAEA;AACL;AACAD,yBAAOW,IAAP,CAAY,uBAAZ;;AACA,UAAI;AACFa,QAAAA,sBAAsB,CACpB1B,IAAI,CAACuB,IADe,EAEpBvB,IAAI,CAAC2B,QAFe,EAGpB5B,MAAM,CAAC6B,eAHa,CAAtB;AAKD,OAND,CAME,OAAOR,KAAP,EAAc;AACdlB,2BAAOC,IAAP,CACG,+GACCiB,KAAK,CAACS,OACP,EAHH;AAKD;AACF;;AACD,WAAOP,WAAW,CAACtB,IAAD,EAAOQ,cAAP,CAAlB;AACD,GAvBM,CAAP;AAwBD,C,CAED;;;AACA,SAASc,WAAT,CAAqBtB,IAArB,EAAkCQ,cAAlC,EAAkE;AAChEsB,EAAAA,OAAO,CAACC,KAAR,CAAcC,gBAAKC,IAAL,CAAUjC,IAAI,CAACK,IAAf,EAAqB,SAArB,CAAd;AACA,QAAM6B,GAAG,GAAGJ,OAAO,CAACK,QAAR,CAAiBC,UAAjB,CAA4B,KAA5B,IAAqC,aAArC,GAAqD,WAAjE,CAFgE,CAIhE;;AACA,QAAM;AAACC,IAAAA;AAAD,MAAY7B,cAAlB;AACA,QAAM;AAACJ,IAAAA;AAAD,MAAcJ,IAApB,CANgE,CAOhE;;AACA,QAAMsC,eAAe,GAAGC,cAAGC,YAAH,CACrB,GAAEpC,SAAS,IAAIiC,OAAQ,+BADF,EAEtB,MAFsB,CAAxB;;AAKA,MAAII,qBAAqB,GAAGH,eAAe,CAACI,KAAhB,CAAsB,iBAAtB,CAA5B;;AACA,MAAI,CAACD,qBAAD,IAA0BA,qBAAqB,CAACE,MAAtB,KAAiC,CAA/D,EAAkE;AAChE,UAAM,KAAIhC,oBAAJ,EACH,mEAAkEG,iBAAM8B,SAAN,CAAgB5B,GAAhB,CAChE,GAAEZ,SAAS,IAAIiC,OAAQ,+BADyC,CAEjE,EAHE,CAAN;AAKD;;AAED,MAAIzC,WAAW,GAAG6C,qBAAqB,CAAC,CAAD,CAAvC;;AAEA,MAAI,CAAC9C,mBAAmB,CAACC,WAAD,CAAxB,EAAuC;AACrCM,uBAAOC,IAAP,CACG,uCAAsCW,iBAAM+B,KAAN,CACrCjD,WADqC,CAErC,kFAAiFkB,iBAAM8B,SAAN,CAAgB5B,GAAhB,CACjF,2DADiF,CAEjF,EALJ,EADqC,CAOlC;;AACJ;;AAED,QAAM8B,OAAO,GAAG,0BAAhB;;AACA,MAAI9C,IAAI,CAAC+C,QAAT,EAAmB;AACjB,WAAOC,mBAAmB,CAAChD,IAAD,EAAOkC,GAAP,EAAYtC,WAAZ,EAAyBkD,OAAzB,EAAkCtC,cAAlC,CAA1B;AACD,GAFD,MAEO;AACL,WAAO,8BAAgBR,IAAhB,EAAsBkC,GAAtB,EAA2BtC,WAA3B,EAAwCkD,OAAxC,EAAiDtC,cAAjD,CAAP;AACD;AACF;;AAED,SAASwC,mBAAT,CACEhD,IADF,EAEEiD,OAFF,EAGErD,WAHF,EAIEkD,OAJF,EAKEtC,cALF,EAME;AACA,QAAM0C,OAAO,GAAGC,aAAIC,UAAJ,CAAeN,OAAf,CAAhB;;AACA,QAAM;AAACC,IAAAA;AAAD,MAAa/C,IAAnB;;AACA,MAAIkD,OAAO,CAACP,MAAR,GAAiB,CAAjB,IAAsBI,QAA1B,EAAoC;AAClC,QAAIG,OAAO,CAACG,OAAR,CAAgBN,QAAhB,MAA8B,CAAC,CAAnC,EAAsC;AACpCO,MAAAA,QAAQ,CAACL,OAAD,EAAUzC,cAAc,CAAC+C,SAAzB,CAAR;AACAC,MAAAA,wBAAwB,CACtBxD,IADsB,EAEtB+C,QAFsB,EAGtBnD,WAHsB,EAItBkD,OAJsB,EAKtBtC,cALsB,CAAxB;AAOD,KATD,MASO;AACLN,yBAAOkB,KAAP,CACG,uCAAsC2B,QAAS,wCADlD,EAEE,GAAGG,OAFL;AAID;AACF,GAhBD,MAgBO;AACLhD,uBAAOkB,KAAP,CAAa,0CAAb;AACD;AACF;;AAED,SAASkC,QAAT,CAAkBL,OAAlB,EAAmCM,SAAnC,EAAsD;AACpD,MAAI;AACF;AACA,UAAME,UAAU,GAAG,CAAC,OAAD,EAAU,IAAV,EAAgB,MAAhB,CAAnB;;AACAvD,uBAAOW,IAAP,CAAY,qBAAZ;;AACAX,uBAAOwD,KAAP,CAAc,oBAAmBT,OAAQ,IAAGQ,UAAU,CAACxB,IAAX,CAAgB,GAAhB,CAAqB,GAAjE;;AACA0B,qBAAMC,IAAN,CAAWX,OAAX,EAAoBQ,UAApB,EAAgC;AAACtC,MAAAA,KAAK,EAAE,SAAR;AAAmB0C,MAAAA,GAAG,EAAEN;AAAxB,KAAhC;AACD,GAND,CAME,OAAOnC,KAAP,EAAc;AACd,UAAM,KAAIT,oBAAJ,EAAa,0BAAb,EAAyCS,KAAzC,CAAN;AACD;AACF;;AAED,SAAS0C,qBAAT,CACE9D,IADF,EAEE8C,OAFF,EAGEiB,MAHF,EAIEvD,cAJF,EAKE;AACA,MAAI;AACF;AACA,UAAM;AAAC6B,MAAAA,OAAD;AAAUkB,MAAAA;AAAV,QAAuB/C,cAA7B;AACA,UAAM;AAACJ,MAAAA;AAAD,QAAcJ,IAApB;AACA,UAAMgE,OAAO,GAAGhE,IAAI,CAACgE,OAAL,CAAaC,WAAb,EAAhB;AACA,UAAMC,cAAc,GAAI,GAAEX,SAAU,IAAGlB,OAAQ,sBAAqB2B,OAAQ,EAA5E;AACA,UAAMG,OAAO,GAAGC,iBAAiB,CAC/BhE,SAAS,IAAIiC,OADkB,EACT;AACtBS,IAAAA,OAF+B,EAG/BkB,OAH+B,EAI/BD,MAJ+B,EAK/BG,cAL+B,CAAjC;AAQA,UAAMG,SAAS,GAAI,GAAEH,cAAe,IAAGC,OAAQ,EAA/C;AACA,UAAMG,OAAO,GAAG,CAAC,IAAD,EAAOP,MAAP,EAAe,SAAf,EAA0B,IAA1B,EAAgC,IAAhC,EAAsCM,SAAtC,CAAhB;;AACAnE,uBAAOW,IAAP,CAAa,qCAAoCkD,MAAO,MAAxD;;AACA7D,uBAAOwD,KAAP,CACG,yCAAwCK,MAAO,kBAAiBM,SAAU,GAD7E;;AAGAV,qBAAMC,IAAN,CAAWd,OAAX,EAAoBwB,OAApB,EAA6B;AAACnD,MAAAA,KAAK,EAAE;AAAR,KAA7B;AACD,GArBD,CAqBE,OAAOC,KAAP,EAAc;AACd,UAAM,KAAIT,oBAAJ,EAAa,0CAAb,EAAyDS,KAAzD,CAAN;AACD;AACF;;AAED,SAASgD,iBAAT,CACE/B,OADF,EAEES,OAFF,EAGEkB,OAHF,EAIED,MAJF,EAKEG,cALF,EAME;AACA,QAAMK,aAAa,GAAGpB,aAAIqB,gBAAJ,CAAqB1B,OAArB,EAA8BiB,MAA9B,CAAtB,CADA,CAGA;;;AACA,OAAK,MAAMU,YAAX,IAA2BF,aAAa,CAACG,MAAd,CAAqB,WAArB,CAA3B,EAA8D;AAC5D,UAAMC,OAAO,GAAI,GAAEtC,OAAQ,IAAGoC,YAAa,IAAGT,OAAQ,MAAtD;;AACA,QAAIzB,cAAGqC,UAAH,CAAe,GAAEV,cAAe,IAAGS,OAAQ,EAA3C,CAAJ,EAAmD;AACjD,aAAOA,OAAP;AACD;AACF,GATD,CAWA;;;AACA,QAAMA,OAAO,GAAI,GAAEtC,OAAQ,IAAG2B,OAAQ,MAAtC;;AACA,MAAIzB,cAAGqC,UAAH,CAAe,GAAEV,cAAe,IAAGS,OAAQ,EAA3C,CAAJ,EAAmD;AACjD,WAAOA,OAAP;AACD;;AAED,QAAM,KAAIhE,oBAAJ,EAAa,8CAAb,CAAN;AACD;;AAED,SAAS6C,wBAAT,CACExD,IADF,EAEE6E,cAFF,EAGEjF,WAHF,EAIEkD,OAJF,EAKEtC,cALF,EAME;AACA,iCAAiBR,IAAI,CAACuB,IAAtB,EAA4BsD,cAA5B;AACAf,EAAAA,qBAAqB,CAAC9D,IAAD,EAAO8C,OAAP,EAAgB+B,cAAhB,EAAgCrE,cAAhC,CAArB;AACA,qCAAqBqE,cAArB,EAAqCjF,WAArC,EAAkDkD,OAAlD,EAA2D9C,IAA3D;AACD;;AAED,SAAS0B,sBAAT,CACEH,IADF,EAEEI,QAFF,EAGEC,eAHF,EAIE;AACA;;;AAGA,QAAMkD,SAAS,GAAG,OAAOjF,IAAP,CAAYiC,OAAO,CAACK,QAApB,CAAlB;AACA,QAAM4C,UAAU,GAAGD,SAAS,GACxB,oBADwB,GAExB,wBAFJ;AAGA,QAAME,mBAAmB,GAAGF,SAAS,GAAG,eAAH,GAAqB,eAA1D;AACA,QAAMG,iBAAiB,GAAGH,SAAS,GAC9B,sBAAqBvD,IAAK,EADI,GAE9B,yBAAwBA,IAAK,EAFlC;AAIA;;;;AAGA,QAAM2D,oBAAoB,GAAGlD,gBAAKC,IAAL,CAC3BL,eAD2B,EAE1B,WAAUmD,UAAW,EAFK,CAA7B;AAKA;;;;;;AAIA,QAAMI,UAAU,GAAGnD,gBAAKoD,OAAL,CAAaF,oBAAb,CAAnB;;AACA,QAAMG,eAAe,GAAGrD,gBAAKC,IAAL,CAAUkD,UAAV,EAAsBH,mBAAtB,CAAxB;;AACA,QAAMM,UAA6B,GAAG;AAACzB,IAAAA,GAAG,EAAEsB;AAAN,GAAtC;AAEA;;;;AAGA5C,gBAAGgD,aAAH,CAAiBF,eAAjB,EAAkCJ,iBAAlC,EAAqD;AACnDO,IAAAA,QAAQ,EAAE,MADyC;AAEnDC,IAAAA,IAAI,EAAE;AAF6C,GAArD;;AAKA,MAAI3D,OAAO,CAACK,QAAR,KAAqB,QAAzB,EAAmC;AACjC,QAAI;AACF,aAAOwB,iBAAMC,IAAN,CACL,MADK,EAEL,CAAC,IAAD,EAAOjC,QAAP,EAAiBuD,oBAAjB,CAFK,EAGLI,UAHK,CAAP;AAKD,KAND,CAME,OAAOlE,KAAP,EAAc;AACd,aAAOuC,iBAAMC,IAAN,CAAW,MAAX,EAAmB,CAACsB,oBAAD,CAAnB,EAA2CI,UAA3C,CAAP;AACD;AACF;;AACD,MAAIxD,OAAO,CAACK,QAAR,KAAqB,OAAzB,EAAkC;AAChC,QAAI;AACF,aAAOwB,iBAAMC,IAAN,CAAWjC,QAAX,EAAqB,CAAC,IAAD,EAAQ,MAAKuD,oBAAqB,EAAlC,CAArB,oBACFI,UADE;AAELI,QAAAA,QAAQ,EAAE;AAFL,SAAP;AAID,KALD,CAKE,OAAOtE,KAAP,EAAc;AACd;AACA,aAAOuC,iBAAMC,IAAN,CAAW,IAAX,EAAiB,CAACsB,oBAAD,CAAjB,EAAyCI,UAAzC,CAAP;AACD;AACF;;AACD,MAAI,OAAOzF,IAAP,CAAYiC,OAAO,CAACK,QAApB,CAAJ,EAAmC;AACjC;AACA,WAAO,sBAAM,SAAN,EAAiB,CAAC,IAAD,EAAO+C,oBAAP,CAAjB,oBACFI,UADE;AAELI,MAAAA,QAAQ,EAAE,IAFL;AAGLvE,MAAAA,KAAK,EAAE;AAHF,OAAP;AAKD;;AACDjB,qBAAOkB,KAAP,CACG,+CAA8CU,OAAO,CAACK,QAAS,EADlE;;AAGA;AACD;;eAEc;AACbwD,EAAAA,IAAI,EAAE,aADO;AAEbC,EAAAA,WAAW,EACT,yEAHW;AAIbC,EAAAA,IAAI,EAAEvF,UAJO;AAKbwF,EAAAA,OAAO,EAAE,CACP;AACEH,IAAAA,IAAI,EAAE,iBADR;AAEEC,IAAAA,WAAW,EACT,0IAHJ;AAIEG,IAAAA,OAAO,EAAE;AAJX,GADO,EAOP;AACEJ,IAAAA,IAAI,EAAE,oBADR;AAEEC,IAAAA,WAAW,EAAE,kCAFf;AAGEG,IAAAA,OAAO,EAAE;AAHX,GAPO,EAYP;AACEJ,IAAAA,IAAI,EAAE,sBADR;AAEEC,IAAAA,WAAW,EACT;AAHJ,GAZO,EAiBP;AACED,IAAAA,IAAI,EAAE,kBADR;AAEEC,IAAAA,WAAW,EACT,0HAHJ;AAIEG,IAAAA,OAAO,EAAE;AAJX,GAjBO,EAuBP;AACEJ,IAAAA,IAAI,EAAE,wBADR;AAEEC,IAAAA,WAAW,EAAE,uDAFf;AAGEG,IAAAA,OAAO,EAAE;AAHX,GAvBO,EA4BP;AACEJ,IAAAA,IAAI,EAAE,0BADR;AAEEC,IAAAA,WAAW,EAAE,+BAFf;AAGEG,IAAAA,OAAO,EAAE;AAHX,GA5BO,EAiCP;AACEJ,IAAAA,IAAI,EAAE,qBADR;AAEEC,IAAAA,WAAW,EACT,2EACA;AAJJ,GAjCO,EAuCP;AACED,IAAAA,IAAI,EAAE,eADR;AAEEC,IAAAA,WAAW,EAAE;AAFf,GAvCO,EA2CP;AACED,IAAAA,IAAI,EAAE,iBADR;AAEEI,IAAAA,OAAO,EAAEjE,OAAO,CAACkE,GAAR,CAAYC,cAAZ,IAA8B,IAFzC;AAGEC,IAAAA,KAAK,EAAGC,GAAD,IAAiBC,MAAM,CAACD,GAAD;AAHhC,GA3CO,EAgDP;AACER,IAAAA,IAAI,EAAE,qBADR;AAEEC,IAAAA,WAAW,EACT,+EAHJ;AAIEG,IAAAA,OAAO,EAAE;AAJX,GAhDO,EAsDP;AACEJ,IAAAA,IAAI,EAAE,gBADR;AAEEC,IAAAA,WAAW,EAAE,0DAFf;AAGEM,IAAAA,KAAK,EAAGC,GAAD,IAAiBA,GAAG,CAACE,KAAJ,CAAU,GAAV;AAH1B,GAtDO,EA2DP;AACEV,IAAAA,IAAI,EAAE,eADR;AAEEC,IAAAA,WAAW,EACT,8MAHJ;AAIEG,IAAAA,OAAO,EAAE;AAJX,GA3DO;AALI,C","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport path from 'path';\nimport execa from 'execa';\nimport chalk from 'chalk';\nimport fs from 'fs';\nimport {Config} from '@react-native-community/cli-types';\nimport adb from './adb';\nimport runOnAllDevices from './runOnAllDevices';\nimport tryRunAdbReverse from './tryRunAdbReverse';\nimport tryLaunchAppOnDevice from './tryLaunchAppOnDevice';\nimport getAdbPath from './getAdbPath';\nimport {\n  isPackagerRunning,\n  logger,\n  getDefaultUserTerminal,\n  CLIError,\n} from '@react-native-community/cli-tools';\nimport warnAboutManuallyLinkedLibs from '../../link/warnAboutManuallyLinkedLibs';\n\n// Validates that the package name is correct\nfunction validatePackageName(packageName: string) {\n  return /^[a-z][a-z0-9_]*(\\.[a-z][a-z0-9_]*)+$/.test(packageName);\n}\n\nfunction displayWarnings(config: Config, args: Flags) {\n  warnAboutManuallyLinkedLibs(config);\n  if (args.appId) {\n    logger.warn(\n      'Using deprecated \"--appId\" flag. Use \"platforms.android.appName\" in react-native.config.js instead.',\n    );\n  }\n  if (args.appFolder) {\n    logger.warn(\n      'Using deprecated \"--appFolder\" flag. Use \"platforms.android.appName\" in react-native.config.js instead.',\n    );\n  }\n  if (args.root) {\n    logger.warn(\n      'Using deprecated \"--root\" flag. App root is discovered automatically.',\n    );\n  }\n}\n\nexport interface Flags {\n  tasks?: Array<string>;\n  root: string;\n  variant: string;\n  appFolder: string;\n  appId: string;\n  appIdSuffix: string;\n  mainActivity: string;\n  deviceId?: string;\n  packager: boolean;\n  port: number;\n  terminal: string;\n  jetifier: boolean;\n}\n\ntype AndroidProject = NonNullable<Config['project']['android']>;\n\n/**\n * Starts the app on a connected Android emulator or device.\n */\nasync function runAndroid(_argv: Array<string>, config: Config, args: Flags) {\n  displayWarnings(config, args);\n  const androidProject = config.project.android;\n\n  if (!androidProject) {\n    throw new CLIError(`\n  Android project not found. Are you sure this is a React Native project?\n  If your Android files are located in a non-standard location (e.g. not inside \\'android\\' folder), consider setting\n  \\`project.android.sourceDir\\` option to point to a new location.\n`);\n  }\n\n  if (args.jetifier) {\n    logger.info(\n      `Running ${chalk.bold(\n        'jetifier',\n      )} to migrate libraries to AndroidX. ${chalk.dim(\n        'You can disable it using \"--no-jetifier\" flag.',\n      )}`,\n    );\n\n    try {\n      await execa(require.resolve('jetifier/bin/jetify'), {stdio: 'inherit'});\n    } catch (error) {\n      throw new CLIError('Failed to run jetifier.', error);\n    }\n  }\n\n  if (!args.packager) {\n    return buildAndRun(args, androidProject);\n  }\n\n  return isPackagerRunning(args.port).then((result: string) => {\n    if (result === 'running') {\n      logger.info('JS server already running.');\n    } else if (result === 'unrecognized') {\n      logger.warn('JS server not recognized, continuing with build...');\n    } else {\n      // result == 'not_running'\n      logger.info('Starting JS server...');\n      try {\n        startServerInNewWindow(\n          args.port,\n          args.terminal,\n          config.reactNativePath,\n        );\n      } catch (error) {\n        logger.warn(\n          `Failed to automatically start the packager server. Please run \"react-native start\" manually. Error details: ${\n            error.message\n          }`,\n        );\n      }\n    }\n    return buildAndRun(args, androidProject);\n  });\n}\n\n// Builds the app and runs it on a connected emulator / device.\nfunction buildAndRun(args: Flags, androidProject: AndroidProject) {\n  process.chdir(path.join(args.root, 'android'));\n  const cmd = process.platform.startsWith('win') ? 'gradlew.bat' : './gradlew';\n\n  // \"app\" is usually the default value for Android apps with only 1 app\n  const {appName} = androidProject;\n  const {appFolder} = args;\n  // @ts-ignore\n  const androidManifest = fs.readFileSync(\n    `${appFolder || appName}/src/main/AndroidManifest.xml`,\n    'utf8',\n  );\n\n  let packageNameMatchArray = androidManifest.match(/package=\"(.+?)\"/);\n  if (!packageNameMatchArray || packageNameMatchArray.length === 0) {\n    throw new CLIError(\n      `Failed to build the app: No package name found. Found errors in ${chalk.underline.dim(\n        `${appFolder || appName}/src/main/AndroidManifest.xml`,\n      )}`,\n    );\n  }\n\n  let packageName = packageNameMatchArray[1];\n\n  if (!validatePackageName(packageName)) {\n    logger.warn(\n      `Invalid application's package name \"${chalk.bgRed(\n        packageName,\n      )}\" in 'AndroidManifest.xml'. Read guidelines for setting the package name here: ${chalk.underline.dim(\n        'https://developer.android.com/studio/build/application-id',\n      )}`,\n    ); // we can also directly add the package naming rules here\n  }\n\n  const adbPath = getAdbPath();\n  if (args.deviceId) {\n    return runOnSpecificDevice(args, cmd, packageName, adbPath, androidProject);\n  } else {\n    return runOnAllDevices(args, cmd, packageName, adbPath, androidProject);\n  }\n}\n\nfunction runOnSpecificDevice(\n  args: Flags,\n  gradlew: 'gradlew.bat' | './gradlew',\n  packageName: string,\n  adbPath: string,\n  androidProject: AndroidProject,\n) {\n  const devices = adb.getDevices(adbPath);\n  const {deviceId} = args;\n  if (devices.length > 0 && deviceId) {\n    if (devices.indexOf(deviceId) !== -1) {\n      buildApk(gradlew, androidProject.sourceDir);\n      installAndLaunchOnDevice(\n        args,\n        deviceId,\n        packageName,\n        adbPath,\n        androidProject,\n      );\n    } else {\n      logger.error(\n        `Could not find device with the id: \"${deviceId}\". Please choose one of the following:`,\n        ...devices,\n      );\n    }\n  } else {\n    logger.error('No Android device or emulator connected.');\n  }\n}\n\nfunction buildApk(gradlew: string, sourceDir: string) {\n  try {\n    // using '-x lint' in order to ignore linting errors while building the apk\n    const gradleArgs = ['build', '-x', 'lint'];\n    logger.info('Building the app...');\n    logger.debug(`Running command \"${gradlew} ${gradleArgs.join(' ')}\"`);\n    execa.sync(gradlew, gradleArgs, {stdio: 'inherit', cwd: sourceDir});\n  } catch (error) {\n    throw new CLIError('Failed to build the app.', error);\n  }\n}\n\nfunction tryInstallAppOnDevice(\n  args: Flags,\n  adbPath: string,\n  device: string,\n  androidProject: AndroidProject,\n) {\n  try {\n    // \"app\" is usually the default value for Android apps with only 1 app\n    const {appName, sourceDir} = androidProject;\n    const {appFolder} = args;\n    const variant = args.variant.toLowerCase();\n    const buildDirectory = `${sourceDir}/${appName}/build/outputs/apk/${variant}`;\n    const apkFile = getInstallApkName(\n      appFolder || appName, // TODO: remove appFolder\n      adbPath,\n      variant,\n      device,\n      buildDirectory,\n    );\n\n    const pathToApk = `${buildDirectory}/${apkFile}`;\n    const adbArgs = ['-s', device, 'install', '-r', '-d', pathToApk];\n    logger.info(`Installing the app on the device \"${device}\"...`);\n    logger.debug(\n      `Running command \"cd android && adb -s ${device} install -r -d ${pathToApk}\"`,\n    );\n    execa.sync(adbPath, adbArgs, {stdio: 'inherit'});\n  } catch (error) {\n    throw new CLIError('Failed to install the app on the device.', error);\n  }\n}\n\nfunction getInstallApkName(\n  appName: string,\n  adbPath: string,\n  variant: string,\n  device: string,\n  buildDirectory: string,\n) {\n  const availableCPUs = adb.getAvailableCPUs(adbPath, device);\n\n  // check if there is an apk file like app-armeabi-v7a-debug.apk\n  for (const availableCPU of availableCPUs.concat('universal')) {\n    const apkName = `${appName}-${availableCPU}-${variant}.apk`;\n    if (fs.existsSync(`${buildDirectory}/${apkName}`)) {\n      return apkName;\n    }\n  }\n\n  // check if there is a default file like app-debug.apk\n  const apkName = `${appName}-${variant}.apk`;\n  if (fs.existsSync(`${buildDirectory}/${apkName}`)) {\n    return apkName;\n  }\n\n  throw new CLIError('Could not find the correct install APK file.');\n}\n\nfunction installAndLaunchOnDevice(\n  args: Flags,\n  selectedDevice: string,\n  packageName: string,\n  adbPath: string,\n  androidProject: AndroidProject,\n) {\n  tryRunAdbReverse(args.port, selectedDevice);\n  tryInstallAppOnDevice(args, adbPath, selectedDevice, androidProject);\n  tryLaunchAppOnDevice(selectedDevice, packageName, adbPath, args);\n}\n\nfunction startServerInNewWindow(\n  port: number,\n  terminal: string,\n  reactNativePath: string,\n) {\n  /**\n   * Set up OS-specific filenames and commands\n   */\n  const isWindows = /^win/.test(process.platform);\n  const scriptFile = isWindows\n    ? 'launchPackager.bat'\n    : 'launchPackager.command';\n  const packagerEnvFilename = isWindows ? '.packager.bat' : '.packager.env';\n  const portExportContent = isWindows\n    ? `set RCT_METRO_PORT=${port}`\n    : `export RCT_METRO_PORT=${port}`;\n\n  /**\n   * Set up the `.packager.(env|bat)` file to ensure the packager starts on the right port.\n   */\n  const launchPackagerScript = path.join(\n    reactNativePath,\n    `scripts/${scriptFile}`,\n  );\n\n  /**\n   * Set up the `launchpackager.(command|bat)` file.\n   * It lives next to `.packager.(bat|env)`\n   */\n  const scriptsDir = path.dirname(launchPackagerScript);\n  const packagerEnvFile = path.join(scriptsDir, packagerEnvFilename);\n  const procConfig: execa.SyncOptions = {cwd: scriptsDir};\n\n  /**\n   * Ensure we overwrite file by passing the `w` flag\n   */\n  fs.writeFileSync(packagerEnvFile, portExportContent, {\n    encoding: 'utf8',\n    flag: 'w',\n  });\n\n  if (process.platform === 'darwin') {\n    try {\n      return execa.sync(\n        'open',\n        ['-a', terminal, launchPackagerScript],\n        procConfig,\n      );\n    } catch (error) {\n      return execa.sync('open', [launchPackagerScript], procConfig);\n    }\n  }\n  if (process.platform === 'linux') {\n    try {\n      return execa.sync(terminal, ['-e', `sh ${launchPackagerScript}`], {\n        ...procConfig,\n        detached: true,\n      });\n    } catch (error) {\n      // By default, the child shell process will be attached to the parent\n      return execa.sync('sh', [launchPackagerScript], procConfig);\n    }\n  }\n  if (/^win/.test(process.platform)) {\n    // Awaiting this causes the CLI to hang indefinitely, so this must execute without await.\n    return execa('cmd.exe', ['/C', launchPackagerScript], {\n      ...procConfig,\n      detached: true,\n      stdio: 'ignore',\n    });\n  }\n  logger.error(\n    `Cannot start the packager. Unknown platform ${process.platform}`,\n  );\n  return;\n}\n\nexport default {\n  name: 'run-android',\n  description:\n    'builds your app and starts it on a connected Android emulator or device',\n  func: runAndroid,\n  options: [\n    {\n      name: '--root [string]',\n      description:\n        '[DEPRECATED - root is discovered automatically] Override the root directory for the android build (which contains the android directory)',\n      default: '',\n    },\n    {\n      name: '--variant [string]',\n      description: \"Specify your app's build variant\",\n      default: 'debug',\n    },\n    {\n      name: '--appFolder [string]',\n      description:\n        '[DEPRECATED – use \"platforms.android.appName\" in react-native.config.js] Specify a different application folder name for the android source. If not, we assume is \"app\"',\n    },\n    {\n      name: '--appId [string]',\n      description:\n        '[DEPRECATED – use \"platforms.android.appName\" in react-native.config.js] Specify an applicationId to launch after build.',\n      default: '',\n    },\n    {\n      name: '--appIdSuffix [string]',\n      description: 'Specify an applicationIdSuffix to launch after build.',\n      default: '',\n    },\n    {\n      name: '--main-activity [string]',\n      description: 'Name of the activity to start',\n      default: 'MainActivity',\n    },\n    {\n      name: '--deviceId [string]',\n      description:\n        'builds your app and starts it on a specific device/simulator with the ' +\n        'given device id (listed by running \"adb devices\" on the command line).',\n    },\n    {\n      name: '--no-packager',\n      description: 'Do not launch packager while building',\n    },\n    {\n      name: '--port [number]',\n      default: process.env.RCT_METRO_PORT || 8081,\n      parse: (val: string) => Number(val),\n    },\n    {\n      name: '--terminal [string]',\n      description:\n        'Launches the Metro Bundler in a new window using the specified terminal path.',\n      default: getDefaultUserTerminal(),\n    },\n    {\n      name: '--tasks [list]',\n      description: 'Run custom Gradle tasks. By default it\\'s \"installDebug\"',\n      parse: (val: string) => val.split(','),\n    },\n    {\n      name: '--no-jetifier',\n      description:\n        'Do not run \"jetifier\" – the AndroidX transition tool. By default it runs before Gradle to ease working with libraries that don\\'t support AndroidX yet. See more at: https://www.npmjs.com/package/jetifier.',\n      default: false,\n    },\n  ],\n};\n"]}